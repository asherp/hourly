



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Invoicing - Hourly</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#payments" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="Hourly" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Hourly
            </span>
            <span class="md-header-nav__topic">
              
                Invoicing
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Hourly" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Hourly
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Invoicing
      </label>
    
    <a href="Payments.html" title="Invoicing" class="md-nav__link md-nav__link--active">
      Invoicing
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stripe" class="md-nav__link">
    Stripe
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stripe-setup" class="md-nav__link">
    Stripe Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-install-the-stripe-python-api" class="md-nav__link">
    Step 1 - install the stripe python api:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-a-stripe-account" class="md-nav__link">
    Step 2 - Create a stripe account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-set-environment-variables" class="md-nav__link">
    Step 3 - Set environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hourly-configuration" class="md-nav__link">
    Hourly Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-stripe-invoices" class="md-nav__link">
    Generating Stripe invoices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btcpay" class="md-nav__link">
    BTCPay
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pairing-with-btcpay-server" class="md-nav__link">
    Pairing with BTCPay server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-get-a-pairing-code" class="md-nav__link">
    Step 1 - Get a pairing code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-generate-a-private-key" class="md-nav__link">
    Step 2 - Generate a private key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-a-client" class="md-nav__link">
    Step 3 - Create a client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-generate-a-pairing-token" class="md-nav__link">
    Step 4 - Generate a pairing token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-recreate-the-client" class="md-nav__link">
    Step 5 - Recreate the client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-generate-a-test-invoice" class="md-nav__link">
    Step 6 - Generate a test invoice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hourly-configuration_1" class="md-nav__link">
    Hourly configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hourly-invoicing" class="md-nav__link">
    Hourly Invoicing
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="README.html" title="Time Estimation" class="md-nav__link">
      Time Estimation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="Compensation.html" title="Compensation" class="md-nav__link">
      Compensation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="WorkLog.html" title="WorkLog" class="md-nav__link">
      WorkLog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="FAQ.html" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="press-release.html" title="Press release" class="md-nav__link">
      Press release
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="about.html" title="Author's notes" class="md-nav__link">
      Author's notes
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stripe" class="md-nav__link">
    Stripe
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stripe-setup" class="md-nav__link">
    Stripe Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-install-the-stripe-python-api" class="md-nav__link">
    Step 1 - install the stripe python api:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-a-stripe-account" class="md-nav__link">
    Step 2 - Create a stripe account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-set-environment-variables" class="md-nav__link">
    Step 3 - Set environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hourly-configuration" class="md-nav__link">
    Hourly Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-stripe-invoices" class="md-nav__link">
    Generating Stripe invoices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btcpay" class="md-nav__link">
    BTCPay
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pairing-with-btcpay-server" class="md-nav__link">
    Pairing with BTCPay server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-get-a-pairing-code" class="md-nav__link">
    Step 1 - Get a pairing code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-generate-a-private-key" class="md-nav__link">
    Step 2 - Generate a private key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-a-client" class="md-nav__link">
    Step 3 - Create a client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-generate-a-pairing-token" class="md-nav__link">
    Step 4 - Generate a pairing token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-recreate-the-client" class="md-nav__link">
    Step 5 - Recreate the client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-generate-a-test-invoice" class="md-nav__link">
    Step 6 - Generate a test invoice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hourly-configuration_1" class="md-nav__link">
    Hourly configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hourly-invoicing" class="md-nav__link">
    Hourly Invoicing
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="payments">Payments<a class="headerlink" href="#payments" title="Permanent link">#</a></h1>
<p>With hourly, issuing invoices is a breeze. To issue a stripe invoice:</p>
<p><code>hourly-report invoice=stripe stripe.customer.email=myclient@momandpop.com</code></p>
<p>See the <a href="stripe.html">Instructions for configuring hourly for Stripe</a>.</p>
<p>To issue a <code>BTCPay</code> invoice connected to your BTCPay Server:</p>
<p><code>hourly-report invoice=btcpay</code></p>
<p>See the <a href="btcpayserver.html">Instructions for configuring hourly with a BTCPay server</a>.</p>
<p>Currently, only <code>BTCPay</code> and <code>Stripe</code> are supported. If you are interested
in adding support for other invoicing platforms, issue a pull request. 
If you want to sponsor development for an hourly feature, contact <a href="about.html">Asher</a>.</p>
<h2 id="stripe">Stripe<a class="headerlink" href="#stripe" title="Permanent link">#</a></h2>
<p><a href="https://stripe.com/">Stripe</a> is a popular global payment processing platform for credit cards. They have an <a href="https://stripe.com/docs/billing/invoices/sending">invoice API</a> that allows hourly to issue invoices on your behalf in a single command:</p>
<p><code>hourly-report invoice=stripe stripe.customer.email=my.client@momandpop.com</code></p>
<h3 id="stripe-setup">Stripe Setup<a class="headerlink" href="#stripe-setup" title="Permanent link">#</a></h3>
<h4 id="step-1-install-the-stripe-python-api">Step 1 - install the stripe python api:<a class="headerlink" href="#step-1-install-the-stripe-python-api" title="Permanent link">#</a></h4>
<p><code>pip install --upgrade stripe</code></p>
<h4 id="step-2-create-a-stripe-account">Step 2 - Create a stripe account<a class="headerlink" href="#step-2-create-a-stripe-account" title="Permanent link">#</a></h4>
<p>You will need an account at <a href="https://stripe.com/">Stripe</a>. Be sure to follow the steps for a developer looking to handle one-time payments. You should also set up your <a href="https://dashboard.stripe.com/account/billing/invoice">invoice template settings</a>.</p>
<h4 id="step-3-set-environment-variables">Step 3 - Set environment variables<a class="headerlink" href="#step-3-set-environment-variables" title="Permanent link">#</a></h4>
<p>From the Stripe <a href="https://dashboard.stripe.com/apikeys">dashboard</a>:</p>
<ul>
<li>copy the <code>Secret key</code> and set it as an environment variable <code>STRIPE_API_SECRET_KEY</code></li>
</ul>
<p>You can also paste in the <code>Secret key</code> later as a command-line argument argument to hourly: <code>stripe.secret_key=&lt;your stripe secret key&gt;</code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You will probably want to use your <code>test_</code> API keys first!</p>
</div>
<h3 id="hourly-configuration">Hourly Configuration<a class="headerlink" href="#hourly-configuration" title="Permanent link">#</a></h3>
<p>Hourly provides the following default configuration for stripe invoices:</p>
<div class="codehilite"><pre><span></span><span class="nt">invoice</span><span class="p">:</span>
  <span class="c1"># see https://stripe.com/docs/billing/invoices/create-invoice#python</span>
  <span class="nt">stripe</span><span class="p">:</span>
    <span class="nt">secret_key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${env:STRIPE_API_SECRET_KEY}</span>
    <span class="nt">customer</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">email</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
    <span class="nt">customer_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># skips customer creation if set</span>
    <span class="nt">invoice_item</span><span class="p">:</span>
      <span class="nt">customer</span><span class="p">:</span> <span class="c1"># overridden by customer_id</span>
      <span class="nt">amount</span><span class="p">:</span> <span class="c1"># overrides earnings</span>
      <span class="nt">currency</span><span class="p">:</span> <span class="c1">#  overrides compensation currency</span>
      <span class="nt">description</span><span class="p">:</span> <span class="c1"># overrides &lt;hours worked&gt; from repo.start_date to repo.end_date</span>
    <span class="nt">invoice</span><span class="p">:</span>
      <span class="nt">customer</span><span class="p">:</span> <span class="c1"># overridden by customer_id</span>
      <span class="nt">collection_method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">send_invoice</span>
      <span class="nt">days_until_due</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class="nt">auto_advance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span> <span class="c1"># auto-finalize this draft after ~1 hour.</span>
      <span class="nt">footer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Time sheet generated by hourly</span>
    <span class="nt">send_invoice</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span> <span class="c1"># sends invoice to customer.email immediately</span>
    <span class="nt">return_status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">logging</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">40</span> <span class="c1"># https://docs.python.org/3/library/logging.html#logging-level</span>
</pre></div>


<p>The following fields are subsets of stripe's own API, which has additional fields you can use:</p>
<ul>
<li><a href="https://stripe.com/docs/api/invoices/line_item">invoice_item</a></li>
<li><a href="https://stripe.com/docs/api/customers/create">customer</a></li>
<li><a href="https://stripe.com/docs/api/invoices/create">invoice</a> </li>
</ul>
<p>Any of the defaults can be overridden, either at command line or by your project's <a href="index.html#configuration">configuration override</a>.
However, <code>stripe.customer.email</code> is a required field.</p>
<h3 id="generating-stripe-invoices">Generating Stripe invoices<a class="headerlink" href="#generating-stripe-invoices" title="Permanent link">#</a></h3>
<p>To generate a stripe invoice for your repo, you will need to specify an email address. Hourly will prepare an invoice and ask for confirmation.
Here is an example of what that looks like when I run hourly on the hourly repo:</p>
<p><code>hourly-report invoice=stripe repo.start_date="Jan 1, 2020" stripe.customer.email=apembroke+hourly@gmail.com"</code></p>
<div class="codehilite"><pre><span></span><span class="go">1 days 04:02:14, 28.04 hours worked</span>
<span class="go">2803.72 USD</span>
<span class="go">Generating stripe invoice for Asher Pembroke</span>
<span class="go">creating new customer</span>
<span class="go">new customer_id: cus_GVy3BWS792lu4D</span>
<span class="go">customer:</span>
<span class="go">  description: null</span>
<span class="go">  email: apembroke+hourly@gmail.com</span>
<span class="go">  name: null</span>
<span class="go">customer_id: cus_GVy3BWS792lu4D</span>
<span class="go">invoice:</span>
<span class="go">  auto_advance: false</span>
<span class="go">  collection_method: send_invoice</span>
<span class="go">  customer: cus_GVy3BWS792lu4D</span>
<span class="go">  days_until_due: 30</span>
<span class="go">  footer: Time sheet generated by hourly</span>
<span class="go">invoice_item:</span>
<span class="go">  amount: 280373</span>
<span class="go">  currency: usd</span>
<span class="go">  customer: cus_GVy3BWS792lu4D</span>
<span class="go">  description: 28.04 hours worked from 2020-01-03T18:44:04-05:00 to 2020-01-09T02:04:18-05:00</span>
<span class="go">logging: 40</span>
<span class="go">return_status: false</span>
<span class="go">secret_key: ${env:STRIPE_API_SECRET_KEY}</span>
<span class="go">send_invoice: true</span>

<span class="go">Is this correct? (yes/n): yes</span>
<span class="go">Success!</span>
<span class="go">Invoice will be sent to apembroke+hourly@gmail.com</span>
<span class="go">Invoice may be paid at https://pay.stripe.com/invoice/&lt;---- redacted -----&gt;</span>
<span class="go">View your invoice at https://dashboard.stripe.com</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I have redacted actual payment URL </p>
</div>
<p>The recipient should get an email from stripe to pay by credit card. 
You can test credit card payment using one of their <a href="https://stripe.com/docs/testing#cards">testing cards</a>.
Meanwhile, visiting the url should show you a page like this:</p>
<p><img alt="Stripe Invoice" src="https://github.com/asherp/hourly/raw/master/docs/invoice_stripe.PNG" title="Stripe Invoice" /></p>
<h2 id="btcpay">BTCPay<a class="headerlink" href="#btcpay" title="Permanent link">#</a></h2>
<h3 id="background">Background<a class="headerlink" href="#background" title="Permanent link">#</a></h3>
<p><a href="https://btcpayserver.org/">BTCPay</a> is a decentralized payment processing platform for accepting cryptocurrency. With BTCpay integration, you can issue invoices and receive crypto payments with maximum privacy and minimal cost. You can use a third-party provider or host it yourself - the only difference will be the domain name used to create the local client.</p>
<h3 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">#</a></h3>
<p>First you will need to register and create a store on a <code>BTCPay server</code>.  There are a few free ones <a href="https://docs.btcpayserver.org/deployment/thirdpartyhosting">listed on btcpayserver.org</a>, but please use caution when choosing a free service, as there are privacy trade-offs to consider. For maximum privacy and security, host one yourself.</p>
<p>Once you've chosen a server, connect a bitcoin wallet to your new store. This can be done in your store's general settings, under <code>Derivation Scheme</code>, where you provide your wallet's <code>xpubkey</code> - BTCPay Server uses this key to generate a unique payment address for every invoice issued.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A legitimate BTCPay Server should only ask for your wallet's <code>xpubkey</code> and <strong>NEVER YOUR PRIVATE KEY</strong></p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>BTCPay also supports <a href="https://lightning.network/">Lightning</a> invoices, which allows for instant settlement. This involves some tradeoffs in security and availability.</p>
</div>
<p>Then you will need to install the btcpay-python client</p>
<p><code>pip install btcpay-python</code></p>
<h3 id="pairing-with-btcpay-server">Pairing with BTCPay server<a class="headerlink" href="#pairing-with-btcpay-server" title="Permanent link">#</a></h3>
<p>Follow <a href="https://github.com/btcpayserver/btcpay-python#creating-a-client-the-manual-way-not-necessary-if-you-used-the-easy-method-above">these pairing instructions</a> from the kind <code>BTCPay</code> developers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These instructions correspond to "The manual way" - we want to be able to create a btcpay client on-demand without storing it in a database. </p>
</div>
<p>I'm essentially repeating their instructions below:</p>
<h4 id="step-1-get-a-pairing-code">Step 1 - Get a pairing code<a class="headerlink" href="#step-1-get-a-pairing-code" title="Permanent link">#</a></h4>
<ul>
<li>On your BTCPay server, browse to Stores &gt; Store settings &gt; Access tokens &gt; Create new token</li>
<li>Fill in the form:<ul>
<li>Label: <any string that will help you remember what this pairing is used for></li>
<li>Public key: leave blank</li>
</ul>
</li>
<li>Click save and then copy the 7 digit <code>pairing_code</code> from the success page</li>
</ul>
<h4 id="step-2-generate-a-private-key">Step 2 - Generate a private key<a class="headerlink" href="#step-2-generate-a-private-key" title="Permanent link">#</a></h4>
<p>This can be done with the following code:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">btcpay</span> <span class="kn">import</span> <span class="n">crypto</span>
<span class="n">privkey</span> <span class="o">=</span> <span class="n">crypto</span><span class="o">.</span><span class="n">generate_privkey</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;btcpayserver.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pem</span><span class="p">:</span>
    <span class="n">pem</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">privkey</span><span class="p">)</span>
</pre></div>


<p>Here we store the private key in a <a href="https://wiki.openssl.org/index.php/Command_Line_Elliptic_Curve_Operations#EC_Private_Key_File_Formats"><code>PEM</code></a> file. By default,
hourly will look for <code>btcpayserver.pem</code> in the top level of your git repo, 
but you can use a different name.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not add the pem file to your git repo! List it in your .gitignore so you don't do so by accident.</p>
</div>
<h4 id="step-3-create-a-client">Step 3 - Create a client<a class="headerlink" href="#step-3-create-a-client" title="Permanent link">#</a></h4>
<p>Create a client using host url of your <code>btcpayserver</code>  (e.g. https://btc.exitpay.org) and private key:</p>
<div class="codehilite"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">BTCPayClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host_url</span><span class="p">,</span> <span class="n">pem</span><span class="o">=</span><span class="n">privkey</span><span class="p">)</span>
</pre></div>


<p>Store your server's host url in the environment variable <code>BTCPAYSERVER_HOST</code>.</p>
<h4 id="step-4-generate-a-pairing-token">Step 4 - Generate a pairing token<a class="headerlink" href="#step-4-generate-a-pairing-token" title="Permanent link">#</a></h4>
<p>using the pairing code from Step 1</p>
<div class="codehilite"><pre><span></span><span class="n">token</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">pair_client</span><span class="p">(</span><span class="n">pairing_code</span><span class="p">)</span>

<span class="n">merchant_token</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="s1">&#39;merchant&#39;</span><span class="p">]</span>
</pre></div>


<p>Save the merchant_token as an environment variable <code>BTCPAYSERVER_MERCHANT</code></p>
<h4 id="step-5-recreate-the-client">Step 5 - Recreate the client<a class="headerlink" href="#step-5-recreate-the-client" title="Permanent link">#</a></h4>
<p>Whenever you like:</p>
<div class="codehilite"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">BTCPayClient</span><span class="p">(</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">host_store</span><span class="p">,</span>
    <span class="n">pem</span> <span class="o">=</span> <span class="n">privkey</span><span class="p">,</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">token</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>


<h4 id="step-6-generate-a-test-invoice">Step 6 - Generate a test invoice<a class="headerlink" href="#step-6-generate-a-test-invoice" title="Permanent link">#</a></h4>
<p>Assuming you have completed the steps to connect a wallet to your btcpayserver,
you should be able to run the following code to generate an invoice.</p>
<div class="codehilite"><pre><span></span><span class="n">new_invoice</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_invoice</span><span class="p">({</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;USD&quot;</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_invoice</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
</pre></div>


<p>This should give you a payment url you can email to your client/employer.</p>
<p>Depending on how you set up your BTCPay Server, the invoice will only be valid
for a short period of time (default is 15 minutes). There is a trade-off here: a short time period mitigates the risk of currency fluctuation, but requires that the client/employer must act quickly to pay the invoice.   </p>
<h3 id="hourly-configuration_1">Hourly configuration<a class="headerlink" href="#hourly-configuration_1" title="Permanent link">#</a></h3>
<p>Hourly creates a <code>BTCPayClient</code> through the following configuration:</p>
<div class="codehilite"><pre><span></span><span class="c1"># for invoice spec, see https://bitpay.com/api/#rest-api-resources-invoices</span>

<span class="nt">invoice</span><span class="p">:</span>
  <span class="nt">btcpay</span><span class="p">:</span>
    <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${env:BTCPAYSERVER_HOST}</span>
    <span class="nt">tokens</span><span class="p">:</span>
      <span class="nt">merchant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${env:BTCPAYSERVER_MERCHANT}</span>
    <span class="nt">pem</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">btcpayserver.pem</span> <span class="c1"># file holding btcpayserver private key</span>
    <span class="nt">return_status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">invoice</span><span class="p">:</span>
      <span class="nt">currency</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># will be honored if set</span>
      <span class="nt">price</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># will be honored if set, else determined by wage</span>
      <span class="nt">orderId</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> 
      <span class="nt">fullNotifications</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="nt">extendedNotifications</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="nt">transactionSpeed</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">medium</span>
      <span class="nt">notificationURL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># https://mywebhook.com</span>
      <span class="nt">notificationEmail</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># myemail@email.com</span>
      <span class="nt">redirectURL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># https://yourredirecturl.com</span>
      <span class="nt">buyer</span><span class="p">:</span> 
        <span class="nt">email</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># fox.mulder@trustno.one</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># Fox Mulder</span>
        <span class="nt">phone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># 555-123-456</span>
        <span class="nt">address1</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># 2630 Hegal Place</span>
        <span class="nt">address2</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># Apt 42</span>
        <span class="nt">locality</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># Alexandria</span>
        <span class="nt">region</span><span class="p">:</span> <span class="c1"># VA</span>
        <span class="nt">postalCode</span><span class="p">:</span> <span class="c1"># 23242</span>
        <span class="nt">country</span><span class="p">:</span> <span class="c1"># US</span>
        <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
      <span class="nt">itemDesc</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span> <span class="c1"># will be honored if set, else hourly will provide</span>
</pre></div>


<p>This allows hourly to access your environment variables and the <code>pem</code> file you created above.
Any of these parameters can be overridden when you run hourly. Here are some examples.</p>
<div class="codehilite"><pre><span></span><span class="go">hourly-report invoice=btcpay btcpay.pem=&lt;private key&gt; </span>
<span class="go">hourly-report invoice=btcpay btcpay.pem=/path/to/other/btcpayserver.pem</span>
<span class="go">hourly-report invoice=btcpay btcpay.host=https://myprivateserver.com</span>
</pre></div>


<h2 id="hourly-invoicing">Hourly Invoicing<a class="headerlink" href="#hourly-invoicing" title="Permanent link">#</a></h2>
<p>If you configured hourly with BTCPay, you can generate an invoice for your git repo in a given date range. Here is what that looks like when applied to the hourly repo:</p>
<div class="codehilite"><pre><span></span><span class="go">hourly-report invoice=btcpay payment=btcpay repo.start_date=&quot;Jan 1, 2020&quot; repo.end_date=&quot;Jan 6, 2020&quot;</span>

<span class="go">Processing timesheet for Asher Pembroke</span>
<span class="go">pay period: 2020-01-03 18:44:04-05:00 -&gt; 2020-01-05 18:34:41-05:00</span>
<span class="go">ignoring pro bono</span>
<span class="go">                     TimeIn     LogIn                email                   TimeOut     LogOut                email TimeDelta     Hours</span>
<span class="go">0 2020-01-03 18:44:04-05:00  clock-in  apembroke@gmail.com 2020-01-03 20:31:57-05:00  clock-out  apembroke@gmail.com  01:47:53  1.798056</span>
<span class="go">1 2020-01-03 20:45:54-05:00  clock-in  apembroke@gmail.com 2020-01-03 22:40:56-05:00  clock-out  apembroke@gmail.com  01:55:02  1.917222</span>
<span class="go">2 2020-01-04 13:16:11-05:00  clock-in  apembroke@gmail.com 2020-01-04 14:01:43-05:00  clock-out  apembroke@gmail.com  00:45:32  0.758889</span>
<span class="go">3 2020-01-04 14:55:18-05:00  clock-in  apembroke@gmail.com 2020-01-04 16:35:04-05:00  clock-out  apembroke@gmail.com  01:39:46  1.662778</span>
<span class="go">4 2020-01-04 19:56:53-05:00  clock-in  apembroke@gmail.com 2020-01-04 21:06:20-05:00  clock-out  apembroke@gmail.com  01:09:27  1.157500</span>
<span class="go">5 2020-01-04 23:59:21-05:00  clock-in  apembroke@gmail.com 2020-01-05 03:59:59-05:00  clock-out  apembroke@gmail.com  04:00:38  4.010556</span>
<span class="go">6 2020-01-05 16:32:33-05:00  clock-in  apembroke@gmail.com 2020-01-05 17:03:22-05:00  clock-out  apembroke@gmail.com  00:30:49  0.513611</span>
<span class="go">7 2020-01-05 17:29:01-05:00  clock-in  apembroke@gmail.com 2020-01-05 18:34:41-05:00  clock-out  apembroke@gmail.com  01:05:40  1.094444</span>
<span class="go">0 days 12:54:47, 12.91 hours worked</span>
<span class="go">1291.31 USD</span>
<span class="go">generating invoice for current user Asher Pembroke</span>
<span class="go">buyer:</span>
<span class="go">  address1: null</span>
<span class="go">  address2: null</span>
<span class="go">  country: null</span>
<span class="go">  email: null</span>
<span class="go">  locality: null</span>
<span class="go">  name: null</span>
<span class="go">  notify: true</span>
<span class="go">  phone: null</span>
<span class="go">  postalCode: null</span>
<span class="go">  region: null</span>
<span class="go">currency: USD</span>
<span class="go">extendedNotifications: true</span>
<span class="go">fullNotifications: true</span>
<span class="go">itemDesc: 12.91 hours worked from 2020-01-03T18:44:04-05:00 to 2020-01-05T18:34:41-05:00</span>
<span class="go">notificationEmail: null</span>
<span class="go">notificationURL: null</span>
<span class="go">orderId: null</span>
<span class="go">price: 1291.3055555555554</span>
<span class="go">redirectURL: null</span>
<span class="go">transactionSpeed: medium</span>

<span class="go">Is this correct? (yes/n)yes</span>
<span class="go">Success! Your invoice may be paid here: https://btc.exitpay.org/invoice?id=MoSbFujB7AwcrvfMN21gGC</span>
</pre></div>


<p>Navigate to the payment url provided:</p>
<p><img alt="Hourly Invoice" src="https://github.com/asherp/hourly/raw/master/docs/invoice_screen_shot.PNG" title="Hourly Invoice" /></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="index.html" title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="README.html" title="Time Estimation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Time Estimation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>