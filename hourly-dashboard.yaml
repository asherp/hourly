import:
  dcc: dash.dcc
  html: dash.html
  dbc: dash_bootstrap_components
  daq: dash_daq

app:
  jupyter_dash.JupyterDash:
    external_stylesheets:
      - https://codepen.io/chriddyp/pen/bWLwgP.css
      - https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css
    title: Hourly

repo:
  dbc.Input:
    id: repo-select
    type: text
    placeholder: /path/to/git/repo
    value: ${env:HOURLY_WORKPATH}
    valid: False

clock_in_button:
  html.Button: # html.Button('Submit', id='submit-val', n_clicks=0),
    id: clock-in
    children: Clock In
    n_clicks: 0

clock_out_button:
  html.Button: # html.Button('Submit', id='submit-val', n_clicks=0),
    id: clock-out
    children: Clock Out
    n_clicks: 0

commit_message:
  dcc.Input:
    id: message
    placeholder: commit message
    value: ''

user_name:
  dcc.Input:
    id: git-user-name
    value: ${env:GIT_USER_NAME}

user_email:
  dcc.Input:
    id: git-user-email
    value: ${env:GIT_USER_EMAIL}
    inputMode: email

clock_status:
  html.Div:
    id: clock-status
    children: Clock status

hourly_wage:
  - dbc.Input:
      id: hourly-wage
      min: 0
      value: 100
      type: number
  - html.Div:
      id: hourly-wage-error
      style:
        color: red

qr_slider:
  dcc.Slider:
    id: qr-slider
    min: 4
    max: 20
    step: 1
    value: 5
    updatemode: drag

  # margin-left: auto;
  # margin-right: auto;

invoice_qr:
  align: center
  width: 6
  children:
  - html.Img:
      id: invoice
      style:
        margin: auto

currency:
  dcc.Dropdown:
    id: currency-dropdown
    clearable: False
    options:
      - label: SAT
        value: SAT
      - label: $
        value: USD
      - label: £
        value: GBP
      - label: €
        value: EUR
    value: USD

layout:
  dbc.Container:
    fluid: True
    children:
    - dcc.Location:
        id: url
        refresh: False
    - dcc.Interval:
        id: clock-interval
        n_intervals: 0
        interval: 10000
    - dbc.Row:
        children:
          - dbc.Col:
              children:
              - html.H1: Hourly Lightning
    - dbc.Row:
        children:
        - dbc.Col:
            children: ${repo}
    - dbc.Row:
        justify: start
        children:
        - dbc.Col:
            align: start
            width: 3
            children: ${user_name}
        - dbc.Col:
            align: start
            width: 3
            children: ${user_email}
    - dbc.Row:
        children:
        - dbc.Col:
            children: ${clock_in_button}
        - dbc.Col:
            children: ${clock_out_button}
        - dbc.Col:
            children: ${commit_message}
    - dbc.Row:
        children:
        - dbc.Col:
            children: ${clock_status}
    # - dcc.Markdown:
    #     id: hourly-conf
    - html.Br:
    - dbc.Row:
        align: start
        children:
        - dbc.Col:
            width: auto
            children: ${currency}
        - dbc.Col:
            width: auto
            children: ${hourly_wage}
        - dbc.Col:
            width: auto
            children:
            - dbc.Input:
                id: invoice-amount
                value: 0
                type: number
                placeholder: Invoice amount (sat)
                disabled: True
        - dbc.Col:
            width: auto
            children:
            - dbc.Input:
                id: payment-request
                type: text
                value: ''
                placeholder: lightning payment request
                disabled: True
        - dbc.Col:
            width: 1
            children:
            - dcc.Clipboard:
                target_id: payment-request
                title: copy invoice
                style:
                  # display: inline-block
                  fontSize: 20
                  # verticalAlign: top
    - dbc.Row:
        children:
        - dbc.Col:
            width: 12
            children:
            - ${qr_slider}
    - dbc.Row:
        justify: center
        children:
        - dbc.Col: ${invoice_qr}
    - dbc.Row:
        children:
        - dbc.Col:
            children:
            - dcc.Tabs:
                children:
                - dcc.Tab:
                    label: Files
                    children:
                    - dash_table.DataTable:
                        id: file-table
                        style_data:
                          whiteSpace: normal
                          height: auto
                          lineHeight: 15px
                        style_cell:
                          textAlign: left
                - dcc.Tab:
                    label: Labor
                    children:
                    - dash_table.DataTable:
                        id: labor-table
                        row_selectable: multi
                        style_data:
                          whiteSpace: normal
                          height: auto
                          lineHeight: 15px
                        style_cell:
                          textAlign: left
                - dcc.Tab:
                    label: Work Commits
                    children:
                    - dash_table.DataTable:
                        id: commits-table
                        style_data:
                          whiteSpace: normal
                          height: auto
                          lineHeight: 15px
                        style_cell:
                          textAlign: left
                # - dcc.Tab:
                #     label: Clock Commits
                #     children:
                #     - dash_table.DataTable:
                #         id: clocks-table
                #         style_data:
                #           whiteSpace: normal
                #           height: auto
                #           lineHeight: 15px
                #         style_cell:
                #           textAlign: left




callbacks:
  select_repo:
    input:
      - id: repo-select
        attr: value
    output:
      - id: repo-select
        attr: valid
      - id: repo-select
        attr: invalid
  set_wage:
    input:
      - id: currency-dropdown
        attr: value
      - id: git-user-email
        attr: value
    output:
      - id: hourly-wage
        attr: value
      - id: hourly-wage-error
        attr: children
      - id: hourly-wage
        attr: placeholder
  invoice:
    input:
      - id: labor-table
        attr: selected_rows
      - id: labor-table
        attr: data
      - id: hourly-wage
        attr: value
      - id: currency-dropdown
        attr: value
    output:
      - id: invoice-amount
        attr: value
      - id: payment-request
        attr: value
  render_invoice:
    input:
      - id: payment-request
        attr: value
      - id: qr-slider
        attr: value
    output:
      - id: invoice
        attr: src
  hourly_conf:
    input:
      - id: url
        attr: pathname
      - id: clock-in
        attr: n_clicks
      - id: clock-out
        attr: n_clicks
    state:
      - id: message
        attr: value
      - id: git-user-name
        attr: value
      - id: git-user-email
        attr: value
    output:
      - id: clock-status
        attr: children
      - id: clock-in
        attr: children
      - id: clock-out
        attr: children
      - id: commits-table
        attr: columns
      - id: commits-table
        attr: data
      # - id: clocks-table
      #   attr: columns
      # - id: clocks-table
      #   attr: data
      - id: labor-table
        attr: columns
      - id: labor-table
        attr: data
  # clock_button:
  #   input:
  #     - id: url
  #       attr: pathname
  #     - id: clock-in
  #       attr: n_clicks
  #     - id: clock-out
  #       attr: n_clicks
  #   output:
  #     - id: clock-status
  #       attr: children
  #     - id: clock-in
  #       attr: children
  #     - id: clock-out
  #       attr: children
  # clock_status:
  #   input:
  #     - id: url
  #       attr: pathname
  #     - id: clock-interval
  #       attr: n_intervals
  #   output:
  #     - id: clock-status
  #       attr: children
  # update_table:
  #   input:
  #     - id: url
  #       attr: pathname
  #   output:
  #     - id: table
  #       attr: columns
  #     - id: table
  #       attr: data



